<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Insert title here</title>
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<script src="./libraries/RGraph.common.core.js"></script>
<script src="./libraries/RGraph.common.dynamic.js"></script>
<script src="./libraries/RGraph.common.tooltips.js"></script>
<script src="./libraries/RGraph.common.effects.js"></script>
<script src="./libraries/RGraph.line.js"></script>
<script src="./libraries/jquery.min.js"></script>
<script src="./libraries/RGraph.common.key.js"></script>
<script src="./libraries/RGraph.pie.js"></script>

<link rel="stylesheet" href="demos.css" type="text/css" media="screen" />

<script>
	// indicate which sport has been selected

	var selectedSport;
	var selStartYear;
	var selEndYear;
	var graphs;

	//select the sport
	$(window).load(function() {
		$.getJSON('SportSvt', {
			sport : false
		}, function(results) {
			var sport = $("#sport");
			// $('>option', sport).remove();
			if (results) {
				$.each(results, function(i, result) {
					sport.append($('<option/>').val(result).text(result));
				});
			} else {
				sport.append($('<option/>').text("Please select the sport"));
			}
		})
	})

	//select the start year, after selecting the sport
	$(function() {
		$("#sport").change(
				function() {
					selectedSport = $(this).val();
					$.getJSON('SportSvt', {
						sport : selectedSport,
						startyear : false
					}, function(results) {
						var startyear = $("#startyear");
						$('>option', startyear).remove();
						if (results) {
							startyear.append($('<option/>').text(
									"Please select the Startyear"));
							$.each(results, function(i, result) {
								startyear.append($('<option/>').val(result)
										.text(result));
							});
						} else {
							startyear.append($('<option/>').text(
									"Please select the Startyear"));
						}

					});
				});
	});

	//select the end year after selecting the sport and start year
	$(function() {
		$("#startyear").change(
				function() {
					selStartYear = $(this).val();
					$.getJSON('SportSvt', {
						sport : selectedSport,
						startyear : true,
						value : selStartYear
					}, function(results) {
						var endyear = $("#endyear");
						$('>option', endyear).remove();
						if (results) {
							endyear.append($('<option/>').text(
									"Please select the Endyear"));
							$.each(results, function(i, result) {
								endyear.append($('<option/>').val(result).text(
										result));
							});
						} else {
							endyear.append($('<option/>').text(
									"Please select the Endyear"));
						}
					});
				});
	});

	$(function() {
		$("#endyear").change(function() {
			selEndYear = $(this).val();
		});
	});

	//draw the trend picture
	$(function() {
		$("#trendButton").click(function() {
			$.getJSON('SportGraphSvt', {
				sport : selectedSport,
				startyear : selStartYear,
				endyear : selEndYear
			}, function(results) {

				//draw the graph
				drawGraph(results);
			});
		});
	});

	//refresh the page 
	$(function() {
		$("#clearButton").click(function() {
			window.location = 'CountryTopic.jsp';
		});
	});

	function drawGraph(results) {
		//refresh the div, to refresh the canvas
		$('.GraphContainer').empty();
		$('.GraphContainer')
				.append(
						'<canvas id="cvs" width="450" height="300">[No canvas support]</canvas>');

		//get the graph
		var graph = getGraph('cvs', results);

		//draw the graph
		RGraph.Effects.Line.jQuery.Trace(graph);
	}

	function getGraph(id, results) {
		var graphObject = results;
		if (!pie1) {
			/*                 var line = new RGraph.Line(id, graphObject.golds, graphObject.totals);
			 line.Set('chart.key', ['Gold','Total']);
			 line.Set('chart.key.interactive', true);
			 line.Set('chart.curvy', true);
			 line.Set('chart.curvy.tickmarks', true);
			 line.Set('chart.curvy.tickmarks.fill', null);
			 line.Set('chart.curvy.tickmarks.stroke', '#aaa');
			 line.Set('chart.curvy.tickmarks.stroke.linewidth', 2);
			 line.Set('chart.curvy.tickmarks.size', 5);
			 line.Set('chart.linewidth', 3);
			 line.Set('chart.hmargin', 5);
			 line.Set('chart.labels', graphObject.years);
			 line.Set('chart.tickmarks', 'circle'); */

			var pie1 = new RGraph.Pie('cvs', graphObject.medals);
			pie1.Set('chart.radius', 100);

			/*                 pie1.Set('chart.tooltips', ['John (2%)', 'Richard (29%)', 'Fred (45%)', 'Brian (17%)', 'Peter (7%)']);
			 */
			pie1.Set('chart.labels', graphObject.countries);
			pie1.Set('chart.strokestyle', 'white');
			pie1.Set('chart.linewidth', 5);
			pie1.Set('chart.shadow', true);
			pie1.Set('chart.shadow.blur', 10);
			pie1.Set('chart.shadow.offsetx', 0);
			pie1.Set('chart.shadow.offsety', 0);
			pie1.Set('chart.shadow.color', '#000');
			pie1.Set('chart.text.color', '#999');

			var explode = 20;

			function myExplode(obj) {
				window.__pie__ = pie1;

				for ( var i = 0; i < obj.data.length; ++i) {
					setTimeout('window.__pie__.Explode(' + i + ',10)', i * 50);
				}
			}

			if (RGraph.isOld()) {
				pie1.Draw();

			} else if (navigator.userAgent.toLowerCase().indexOf('firefox') >= 0) {
				RGraph.Effects.Pie.RoundRobin(pie1);

			} else {
				/**
				 * The RoundRobin callback initiates the exploding
				 */

				RGraph.Effects.Pie.RoundRobin(pie1, null, myExplode);
				RGraph.Effects.Pie.Implode(pie1);
			}

		}
		return pie1;
	}
</script>
</head>
<body>


	<form>

		<fieldset>
			<legend>sport visiualization</legend>
			<p>
				<label>sport</label> <br> <select id="sport" name="sport">
					<option>Please select the sport</option>
				</select> <br> <label>Start Year</label> <br> <select
					id="startyear" name="startyear">
					<option>Please select the Startyear</option>
				</select> <br> <label>End Year</label> <br> <select id="endyear"
					name="endyear">
					<option>Please select the Endyear</option>
				</select> <br>
			</p>
		</fieldset>
	</form>
	<p>
		<button id='trendButton'>SEE THE TRENDS!</button>
	</p>
	<div class="GraphContainer">
		<canvas id="cvs" width="450" height="300">[No canvas support]</canvas>
	</div>
	<p>
		<button id='clearButton'>CLEAR TRENDS!</button>
	</p>
</body>
</html>